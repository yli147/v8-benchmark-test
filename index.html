<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V8 Engine Auto Test</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background: #f5f5f5; }
        .test-section { background: white; margin: 10px 0; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .result { background: #f8f9fa; border: 1px solid #dee2e6; padding: 10px; margin: 10px 0; border-radius: 4px; font-family: monospace; font-size: 12px; }
        .running { background: #fff3cd; border-color: #ffeaa7; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        
        .progress-container { 
            display: flex; 
            align-items: center; 
            gap: 15px; 
            margin: 20px 0; 
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .progress { 
            flex: 1; 
            height: 25px; 
            background: #e9ecef; 
            border-radius: 12px; 
            overflow: hidden; 
            position: relative;
        }
        .progress-bar { 
            height: 100%; 
            background: linear-gradient(90deg, #007bff, #0056b3); 
            transition: width 0.3s; 
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 12px;
        }
        .time-stats {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            font-family: monospace;
            font-size: 13px;
            min-width: 160px;
        }
        .elapsed-time {
            color: #007bff;
            font-weight: bold;
            font-size: 15px;
        }
        .estimated-time {
            color: #6c757d;
            font-size: 12px;
        }
        .test-speed {
            color: #28a745;
            font-size: 12px;
        }
        .ms-time {
            font-size: 11px;
            color: #dc3545;
        }
    </style>
</head>
<body>
    <h1>ğŸš€ V8 JavaScript Engine Auto Test</h1>
    
    <div class="progress-container">
        <div class="progress">
            <div id="progress-bar" class="progress-bar" style="width: 0%">0%</div>
        </div>
        <div class="time-stats">
            <div id="elapsed-time" class="elapsed-time">00:00.000</div>
            <div id="estimated-time" class="estimated-time">ETA: --:--.---</div>
            <div id="test-speed" class="test-speed">0 tests/sec</div>
            <div id="ms-time" class="ms-time">0ms total</div>
        </div>
    </div>
    
    <div id="test-container"></div>

    <script>
        const tests = [
            {
                name: "Basic JavaScript Execution",
                tests: [
                    { name: "Basic Calculation", fn: basicExecution },
                    { name: "String Operations", fn: stringOperations },
                    { name: "Array Operations", fn: arrayOperations }
                ]
            },
            {
                name: "Performance Tests",
                tests: [
                    { name: "Loop Performance", fn: performanceTest },
                    { name: "Recursion Performance", fn: recursionTest },
                    { name: "Memory Usage", fn: memoryTest }
                ]
            },
            {
                name: "Asynchronous Operations",
                tests: [
                    { name: "Promise Test", fn: promiseTest },
                    { name: "Async/Await Test", fn: asyncAwaitTest },
                    { name: "Timer Test", fn: timerTest }
                ]
            },
            {
                name: "Error Handling",
                tests: [
                    { name: "Throw Error", fn: errorTest },
                    { name: "Type Error", fn: typeErrorTest },
                    { name: "Catch Errors", fn: catchErrorTest }
                ]
            },
            {
                name: "V8 Features",
                tests: [
                    { name: "ES6+ Features", fn: es6Features },
                    { name: "JIT Optimization", fn: optimizationTest },
                    { name: "Garbage Collection", fn: gcTest }
                ]
            }
        ];

        // æ¯«ç§’çº§æ—¶é—´æ ¼å¼åŒ–å‡½æ•°
        function formatTimeWithMs(milliseconds) {
            const totalMs = Math.floor(milliseconds);
            const ms = totalMs % 1000;
            const totalSeconds = Math.floor(totalMs / 1000);
            const seconds = totalSeconds % 60;
            const minutes = Math.floor(totalSeconds / 60);
            
            return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}.${ms.toString().padStart(3, '0')}`;
        }

        // æ›´æ–°æ—¶é—´ç»Ÿè®¡
        function updateTimeStats(startTime, completedTests, totalTests) {
            const elapsedMs = Date.now() - startTime;
            const elapsed = elapsedMs / 1000;
            const progress = completedTests / totalTests;
            const estimatedTotalMs = progress > 0 ? elapsedMs / progress : 0;
            const remainingMs = Math.max(0, estimatedTotalMs - elapsedMs);
            const testsPerSecond = completedTests / elapsed;

            document.getElementById('elapsed-time').textContent = formatTimeWithMs(elapsedMs);
            document.getElementById('estimated-time').textContent = `ETA: ${formatTimeWithMs(remainingMs)}`;
            document.getElementById('test-speed').textContent = `${testsPerSecond.toFixed(1)} tests/sec`;
            document.getElementById('ms-time').textContent = `${elapsedMs.toFixed(0)}ms total`;
        }

        // æµ‹è¯•å‡½æ•°å®ç°
        function basicExecution() {
            const result = 2 + 2 * 3;
            const complex = Math.sqrt(16) + Math.pow(2, 3);
            return `Basic: 2 + 2 * 3 = ${result}, Complex: âˆš16 + 2Â³ = ${complex}`;
        }

        function stringOperations() {
            const str = "Hello World";
            const reversed = str.split('').reverse().join('');
            const upper = str.toUpperCase();
            return `Original: "${str}", Reversed: "${reversed}", Upper: "${upper}"`;
        }

        function arrayOperations() {
            const arr = [1, 2, 3, 4, 5];
            const doubled = arr.map(x => x * 2);
            const sum = arr.reduce((a, b) => a + b, 0);
            return `Array: [${arr}], Doubled: [${doubled}], Sum: ${sum}`;
        }

        function performanceTest() {
            const start = performance.now();
            let sum = 0;
            for (let i = 0; i < 1000000; i++) {
                sum += i;
            }
            const end = performance.now();
            return `Loop 1M times: ${(end - start).toFixed(3)}ms, Sum: ${sum}`;
        }

        function recursionTest() {
            function fibonacci(n) {
                if (n <= 1) return n;
                return fibonacci(n - 1) + fibonacci(n - 2);
            }
            const start = performance.now();
            const result = fibonacci(30);
            const end = performance.now();
            return `Fibonacci(30): ${result}, Time: ${(end - start).toFixed(3)}ms`;
        }

        function memoryTest() {
            const start = performance.now();
            const arr = new Array(100000).fill(0).map((_, i) => ({ id: i, data: Math.random() }));
            const memUsed = JSON.stringify(arr).length;
            const end = performance.now();
            return `Created 100k objects in ${(end - start).toFixed(3)}ms, Memory: ${(memUsed / 1024 / 1024).toFixed(2)}MB`;
        }

        async function promiseTest() {
            const start = performance.now();
            const promise = new Promise(resolve => setTimeout(() => resolve("Promise resolved!"), 100));
            const result = await promise;
            const end = performance.now();
            return `Promise result: ${result}, Time: ${(end - start).toFixed(3)}ms`;
        }

        async function asyncAwaitTest() {
            const start = performance.now();
            const delay = ms => new Promise(resolve => setTimeout(resolve, ms));
            await delay(50);
            const end = performance.now();
            return `Async/await completed in ${(end - start).toFixed(3)}ms`;
        }

        async function timerTest() {
            return new Promise(resolve => {
                const start = performance.now();
                setTimeout(() => {
                    const elapsed = performance.now() - start;
                    resolve(`Timer test: ${elapsed.toFixed(3)}ms elapsed`);
                }, 100);
            });
        }

        function errorTest() {
            const start = performance.now();
            try {
                throw new Error("Test error");
            } catch (e) {
                const end = performance.now();
                return `Caught error in ${(end - start).toFixed(3)}ms: ${e.message}`;
            }
        }

        function typeErrorTest() {
            const start = performance.now();
            try {
                null.someMethod();
            } catch (e) {
                const end = performance.now();
                return `Type error caught in ${(end - start).toFixed(3)}ms: ${e.name}`;
            }
        }

        function catchErrorTest() {
            const start = performance.now();
            try {
                JSON.parse("invalid json");
            } catch (e) {
                const end = performance.now();
                return `JSON parse error in ${(end - start).toFixed(3)}ms: ${e.name}`;
            }
        }

        function eventTest() {
            const start = performance.now();
            const button = document.createElement('button');
            button.textContent = 'Test Button';
            button.onclick = () => alert('Event fired!');
            document.getElementById('dynamic-content').appendChild(button);
            const end = performance.now();
            return `Event handler attached in ${(end - start).toFixed(3)}ms`;
        }

        function es6Features() {
            const start = performance.now();
            const arr = [1, 2, 3];
            const [first, ...rest] = arr;
            const obj = { a: 1, b: 2 };
            const { a, b } = obj;
            const template = `First: ${first}, Rest: [${rest}], a: ${a}, b: ${b}`;
            const end = performance.now();
            return `ES6 features executed in ${(end - start).toFixed(3)}ms: ${template}`;
        }

        function optimizationTest() {
            function hotFunction(x) {
                return x * x + x;
            }
            const start = performance.now();
            for (let i = 0; i < 1000000; i++) {
                hotFunction(i);
            }
            const end = performance.now();
            return `Hot function called 1M times in ${(end - start).toFixed(3)}ms`;
        }

        function gcTest() {
            const before = performance.now();
            const arrays = [];
            for (let i = 0; i < 1000; i++) {
                arrays.push(new Array(1000).fill(Math.random()));
            }
            arrays.length = 0; // Clear references
            const after = performance.now();
            return `GC test: Created and cleared 1M elements in ${(after - before).toFixed(3)}ms`;
        }

        // è‡ªåŠ¨è¿è¡Œæ‰€æœ‰æµ‹è¯•
        async function runAllTests() {
            const container = document.getElementById('test-container');
            const progressBar = document.getElementById('progress-bar');
            const startTime = Date.now();
            let totalTests = 0;
            let completedTests = 0;

            // è®¡ç®—æ€»æµ‹è¯•æ•°
            tests.forEach(section => totalTests += section.tests.length);

            // å¯åŠ¨æ—¶é—´æ›´æ–°å®šæ—¶å™¨ - æ›´é«˜é¢‘ç‡æ›´æ–°ä»¥æ˜¾ç¤ºæ¯«ç§’å˜åŒ–
            const timeUpdateInterval = setInterval(() => {
                updateTimeStats(startTime, completedTests, totalTests);
            }, 50); // æ¯50msæ›´æ–°ä¸€æ¬¡

            for (const section of tests) {
                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'test-section';
                sectionDiv.innerHTML = `<h3>${section.name}</h3>`;
                container.appendChild(sectionDiv);

                for (const test of section.tests) {
                    const testStartTime = performance.now();
                    const resultDiv = document.createElement('div');
                    resultDiv.className = 'result running';
                    resultDiv.textContent = `Running ${test.name}...`;
                    sectionDiv.appendChild(resultDiv);

                    try {
                        const result = await test.fn();
                        const testEndTime = performance.now();
                        const testDuration = (testEndTime - testStartTime).toFixed(3);
                        resultDiv.className = 'result success';
                        resultDiv.textContent = `âœ… ${test.name} (${testDuration}ms): ${result}`;
                    } catch (error) {
                        const testEndTime = performance.now();
                        const testDuration = (testEndTime - testStartTime).toFixed(3);
                        resultDiv.className = 'result error';
                        resultDiv.textContent = `âŒ ${test.name} (${testDuration}ms): ${error.message}`;
                    }

                    completedTests++;
                    const progressPercent = (completedTests / totalTests) * 100;
                    progressBar.style.width = `${progressPercent}%`;
                    progressBar.textContent = `${Math.round(progressPercent)}%`;
                    
                    // æ›´æ–°æ—¶é—´ç»Ÿè®¡
                    updateTimeStats(startTime, completedTests, totalTests);
                    
                    // çŸ­æš‚å»¶è¿Ÿä»¥ä¾¿è§‚å¯Ÿè¿›åº¦
                    await new Promise(resolve => setTimeout(resolve, 200));
                }
            }

            // æµ‹è¯•å®Œæˆåæ¸…é™¤å®šæ—¶å™¨å¹¶æ˜¾ç¤ºæœ€ç»ˆç»Ÿè®¡
            clearInterval(timeUpdateInterval);
            const totalTimeMs = Date.now() - startTime;
            const totalTimeSec = totalTimeMs / 1000;
            
            document.getElementById('elapsed-time').textContent = formatTimeWithMs(totalTimeMs);
            document.getElementById('estimated-time').textContent = `Completed!`;
            document.getElementById('test-speed').textContent = `Avg: ${(totalTests / totalTimeSec).toFixed(1)} tests/sec`;
            document.getElementById('ms-time').textContent = `${totalTimeMs}ms total`;

        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨å¼€å§‹æµ‹è¯•
        window.addEventListener('load', runAllTests);
    </script>
</body>
</html>
