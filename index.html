<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V8 Engine Auto Test</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background: #f5f5f5; }
        .test-section { background: white; margin: 10px 0; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .result { background: #f8f9fa; border: 1px solid #dee2e6; padding: 10px; margin: 10px 0; border-radius: 4px; font-family: monospace; font-size: 12px; }
        .running { background: #fff3cd; border-color: #ffeaa7; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        
        .progress-container { 
            display: flex; 
            align-items: center; 
            gap: 15px; 
            margin: 20px 0; 
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .progress { 
            flex: 1; 
            height: 25px; 
            background: #e9ecef; 
            border-radius: 12px; 
            overflow: hidden; 
            position: relative;
        }
        .progress-bar { 
            height: 100%; 
            background: linear-gradient(90deg, #007bff, #0056b3); 
            transition: width 0.3s; 
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 12px;
        }
        .time-stats {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            font-family: monospace;
            font-size: 13px;
            min-width: 160px;
        }
        .elapsed-time {
            color: #007bff;
            font-weight: bold;
            font-size: 15px;
        }
        .estimated-time {
            color: #6c757d;
            font-size: 12px;
        }
        .test-speed {
            color: #28a745;
            font-size: 12px;
        }
        .ms-time {
            font-size: 11px;
            color: #dc3545;
        }
    </style>
</head>
<body>
    <h1>ğŸš€ V8 JavaScript Engine Auto Test</h1>
    
    <div class="progress-container">
        <div class="progress">
            <div id="progress-bar" class="progress-bar" style="width: 0%">0%</div>
        </div>
        <div class="time-stats">
            <div id="elapsed-time" class="elapsed-time">00:00.000</div>
            <div id="estimated-time" class="estimated-time">ETA: --:--.---</div>
            <div id="test-speed" class="test-speed">0 tests/sec</div>
            <div id="ms-time" class="ms-time">0ms total</div>
        </div>
    </div>
    
    <div id="test-container"></div>

    <script>
        const tests = [
            {
                name: "Basic JavaScript Execution",
                tests: [
                    { name: "Basic Calculation", fn: basicExecution },
                    { name: "String Operations", fn: stringOperations },
                    { name: "Array Operations", fn: arrayOperations }
                ]
            }
        ];

        // æ¯«ç§’çº§æ—¶é—´æ ¼å¼åŒ–å‡½æ•°
        function formatTimeWithMs(milliseconds) {
            const totalMs = Math.floor(milliseconds);
            const ms = totalMs % 1000;
            const totalSeconds = Math.floor(totalMs / 1000);
            const seconds = totalSeconds % 60;
            const minutes = Math.floor(totalSeconds / 60);
            
            return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}.${ms.toString().padStart(3, '0')}`;
        }

        // æ›´æ–°æ—¶é—´ç»Ÿè®¡
        function updateTimeStats(startTime, completedTests, totalTests) {
            const elapsedMs = Date.now() - startTime;
            const elapsed = elapsedMs / 1000;
            const progress = completedTests / totalTests;
            const estimatedTotalMs = progress > 0 ? elapsedMs / progress : 0;
            const remainingMs = Math.max(0, estimatedTotalMs - elapsedMs);
            const testsPerSecond = completedTests / elapsed;

            document.getElementById('elapsed-time').textContent = formatTimeWithMs(elapsedMs);
            document.getElementById('estimated-time').textContent = `ETA: ${formatTimeWithMs(remainingMs)}`;
            document.getElementById('test-speed').textContent = `${testsPerSecond.toFixed(1)} tests/sec`;
            document.getElementById('ms-time').textContent = `${elapsedMs.toFixed(0)}ms total`;
        }

        // æµ‹è¯•å‡½æ•°å®ç°
        function basicExecution() {
            const result = 2 + 2 * 3;
            const complex = Math.sqrt(16) + Math.pow(2, 3);
            return `Basic: 2 + 2 * 3 = ${result}, Complex: âˆš16 + 2Â³ = ${complex}`;
        }

        function stringOperations() {
            const str = "Hello World";
            const reversed = str.split('').reverse().join('');
            const upper = str.toUpperCase();
            return `Original: "${str}", Reversed: "${reversed}", Upper: "${upper}"`;
        }

        function arrayOperations() {
            const arr = [1, 2, 3, 4, 5];
            const doubled = arr.map(x => x * 2);
            const sum = arr.reduce((a, b) => a + b, 0);
            return `Array: [${arr}], Doubled: [${doubled}], Sum: ${sum}`;
        }

        // è‡ªåŠ¨è¿è¡Œæ‰€æœ‰æµ‹è¯•
        async function runAllTests() {
            const container = document.getElementById('test-container');
            const progressBar = document.getElementById('progress-bar');
            const startTime = Date.now();
            let totalTests = 0;
            let completedTests = 0;

            // è®¡ç®—æ€»æµ‹è¯•æ•°
            tests.forEach(section => totalTests += section.tests.length);

            // å¯åŠ¨æ—¶é—´æ›´æ–°å®šæ—¶å™¨ - æ›´é«˜é¢‘ç‡æ›´æ–°ä»¥æ˜¾ç¤ºæ¯«ç§’å˜åŒ–
            const timeUpdateInterval = setInterval(() => {
                updateTimeStats(startTime, completedTests, totalTests);
            }, 50); // æ¯50msæ›´æ–°ä¸€æ¬¡

            for (const section of tests) {
                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'test-section';
                sectionDiv.innerHTML = `<h3>${section.name}</h3>`;
                container.appendChild(sectionDiv);

                for (const test of section.tests) {
                    const testStartTime = performance.now();
                    const resultDiv = document.createElement('div');
                    resultDiv.className = 'result running';
                    resultDiv.textContent = `Running ${test.name}...`;
                    sectionDiv.appendChild(resultDiv);

                    try {
                        const result = await test.fn();
                        const testEndTime = performance.now();
                        const testDuration = (testEndTime - testStartTime).toFixed(3);
                        resultDiv.className = 'result success';
                        resultDiv.textContent = `âœ… ${test.name} (${testDuration}ms): ${result}`;
                    } catch (error) {
                        const testEndTime = performance.now();
                        const testDuration = (testEndTime - testStartTime).toFixed(3);
                        resultDiv.className = 'result error';
                        resultDiv.textContent = `âŒ ${test.name} (${testDuration}ms): ${error.message}`;
                    }

                    completedTests++;
                    const progressPercent = (completedTests / totalTests) * 100;
                    progressBar.style.width = `${progressPercent}%`;
                    progressBar.textContent = `${Math.round(progressPercent)}%`;
                    
                    // æ›´æ–°æ—¶é—´ç»Ÿè®¡
                    updateTimeStats(startTime, completedTests, totalTests);
                    
                    // çŸ­æš‚å»¶è¿Ÿä»¥ä¾¿è§‚å¯Ÿè¿›åº¦
                    await new Promise(resolve => setTimeout(resolve, 200));
                }
            }

            // æµ‹è¯•å®Œæˆåæ¸…é™¤å®šæ—¶å™¨å¹¶æ˜¾ç¤ºæœ€ç»ˆç»Ÿè®¡
            clearInterval(timeUpdateInterval);
            const totalTimeMs = Date.now() - startTime;
            const totalTimeSec = totalTimeMs / 1000;
            
            document.getElementById('elapsed-time').textContent = formatTimeWithMs(totalTimeMs);
            document.getElementById('estimated-time').textContent = `Completed!`;
            document.getElementById('test-speed').textContent = `Avg: ${(totalTests / totalTimeSec).toFixed(1)} tests/sec`;
            document.getElementById('ms-time').textContent = `${totalTimeMs}ms total`;
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨å¼€å§‹æµ‹è¯•
        window.addEventListener('load', runAllTests);
    </script>
</body>
</html>
